Тестовое задание для Синергия МС.

## Требования

В test.txt

## Запуск

0. (Опционально) Создать виртуальное окружение

```
virtualenv .venv
source .venv/bin/activate
```

1. Поставить зависимости

```
pip install -r requirements.txt
```

2. Мигрировать БД (в тестовой версии используется sqlite)

```
referal/manage.py migrate
```

3. Импортировать записи из json в бд (см "Особенности реализации" ниже)

```
referal/manage.py import_referal_users ./data.json
```

4. Запустить проект

```
referal/manage.py runserver
```

## Тестирование

По умолчанию проект запускается на 127.0.0.1:8000.
Открыв в браузере 127.0.0.1:8000/api/ - попадаем в корень апи.

Какие эндпоинты есть:

- /api/users/ - список реферальных пользователей и их уровень

- /api/users/{referal_id}/ - информация по конкретному пользователю

- /api/users/{referal_id}/detailed/ - детальная информация, включая количество
денег на депозите и бонусных денег полученных от приглашенных пользователей кто
внес депозит.

- /api/users/{referal_id}/add_deposit/ - для добавления депозита на счет конкретного
пользователя (отправкой пост запроса с телом вида {"deposit": 10} или через веб
вью дрфа).

## Особенности реализации

Батч-добавление пользователей в бд осуществляется очень долго (все "тормозит"
логика подсчета уровней пользователей). Для быстрой проверки базового функционала
лучше использовать упрощенный список записей (импорт сделать из wip_data.json):

```
referal/manage.py import_referal_users ./wip_data.json
```

В бранчах wip_bulk и django-mptt лежат попытки ускорить процесс (в одном случае
через bulk_create/bulk_update, в другом - через сторонний пакет django-mptt),
но ни одно из этих решений особо не повлияло на ситуацию. Возможным решением
могла бы быть связка bulk_create/bulk_update для создания пользователей и
их взаимоотношений и "сырого" SQL запроса к бд для подсчета уровней, но это
привязало бы реализацию к конкретной базе данных (а возможно и конкретной
версии базы данных - SQLite, используемый django по умолчанию, до недавнего
времени не поддерживал рекурсивные запросы).
